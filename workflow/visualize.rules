import os

configfile: "configs/config_main.yaml"

control = config["CONTROL"][0]
treat = config["TREAT"][0]
tool = config["DEATOOL"]
reference = config["REFERENCE"]
counter = config["COUNTER"]
mapper = config["ALIGNER"]
main_path = config["MAINPATH"]

if reference == "genome":
    norm_path = config["RESULTPATH"] + "/" + config["PROJECT"] + "/" + mapper + "/dea_"+counter+"/Norm_"+tool
    dea_path = config["RESULTPATH"] + "/" + config["PROJECT"] + "/" + mapper + "/dea_"+counter+"/DEA_"+tool
    output_path = config["RESULTPATH"] + "/" + config["PROJECT"] + "/" + mapper + "/dea_"+counter+"/visualization_"+tool
    count_path = config["RESULTPATH"] + "/" + config["PROJECT"] + "/" + mapper + "/countFile_"+counter

rule end:
        input:
            volcano = output_path + "/volcano_plot_" + control + "_" + treat + ".pdf",
            heatmap = output_path + "/heatmapTop_" + control + "_" + treat + ".pdf",
            pca = output_path + "/PCA_" + control + "_" + treat + ".pdf"

rule plot:
        input:
            norm_path = norm_path,
            dea_path = dea_path,
            count_path = count_path
        output:
            volcano = output_path + "/volcano_plot_" + control + "_" + treat + ".pdf",
            heatmap = output_path + "/heatmapTop_" + control + "_" + treat + ".pdf",
            pca = output_path + "/PCA_" + control + "_" + treat + ".pdf"
        conda:
            "env.yaml"
        params:
            output_path = directory(output_path),
            mp = main_path
        shell:
            "Rscript {params.mp}scripts/visualize.R {input.norm_path} {input.dea_path} {input.count_path} {params.output_path}"
            
